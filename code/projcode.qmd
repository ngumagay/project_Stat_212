---
title: "Project Milestone 1"
author: "Peter Ward, Hayes Waddell, Nathan Gumagay"
format: html
editor: visual
---

# Read in Data and Data Cleaning

```{r}
# Reading in our player name and player data datasets

library(readr)
library(tidyverse)
baseballdata <- read_csv("../data/swing_data.csv")
playerdata <- read_csv("../data/player_data.csv")

playerdataclean <- playerdata %>%
  select(PLAYERNAME, LASTNAME, MLBID)
```
```{r}
# Data cleaning including selecting relevant variables that might be useful in our analysis, joining datasets to include pitcher's names in our main dataset, and filtering out any data points that are NA for bat_speed and swing_length (since we will rely heavily on these variables for our analysis), as well as any data points that don't involve any swing being made(takes, hit by pitches, bunts, etc.)

baseballdataclean <- baseballdata %>%
  select(game_date, release_speed, player_name, events, zone, stand, p_throws, bb_type, balls, strikes, pfx_x, pfx_z, outs_when_up, inning, hit_distance_sc, launch_angle, launch_speed, effective_speed, release_spin_rate, launch_speed_angle, estimated_ba_using_speedangle, estimated_woba_using_speedangle, woba_value, bat_score, fld_score, pitch_name, pitcher, bat_speed, swing_length, description)

baseballdataclean2 <- baseballdataclean %>% 
  left_join(playerdataclean, by = c("pitcher" = "MLBID"))

baseballdataclean2 <- baseballdataclean2 %>%
  filter(bat_speed != 'NA') %>%
  filter(swing_length != 'NA') %>%
  filter(!description %in% c("ball", "called_strike", "blocked_ball", "pitchout", "hit_by_pitch", "foul_bunt","missed_bunt", "bunt_foul_tip"))
  
  
```

```{r}
# Generating a dataset of the top 25 pitchers who generate the fastest bat speeds against, arranged by their average bat speed against with a count of their number of data points

fastswings <- baseballdataclean2 %>%
  filter(!is.na(PLAYERNAME)) %>%
  filter(bat_speed > 75)

pitcheraverage <- fastswings %>%
  group_by(PLAYERNAME) %>%
  summarize(avg_bat_speed = mean(bat_speed)) %>%
  arrange(desc(avg_bat_speed))

pitcheraverage

pitchercount <- fastswings %>%
  group_by(PLAYERNAME) %>%
  count() %>%
  arrange(desc(n))

pitchercount

pitcherfastswing <- pitcheraverage %>% 
  left_join(pitchercount, by = c("PLAYERNAME" = "PLAYERNAME"))

pitcherfastswing

pitcherfastswing2 <- pitcherfastswing %>%
  filter(n >= 8)

top25fast <- pitcherfastswing2 %>%
  arrange(desc(avg_bat_speed)) %>%
  head(25)

top25fast


```
```{r}
# Calculating average spin rate by pitch type for the top 25 pitchers with the highest average swing speed against

top25allfast <-top25fast %>%
  left_join(baseballdataclean2, by = c("PLAYERNAME" = "PLAYERNAME"))

fastspins <- top25allfast %>%
  group_by(pitch_name) %>%
  summarize(meanspinfast = mean(release_spin_rate, na.rm = TRUE))

fastspins
```
```{r}
# Generating a dataset of the top 25 pitchers who generate the slowest bat speeds against, arranged by their average bat speed against with a count of their number of data points

tenth_percentile <- quantile(baseballdataclean2$bat_speed, 0.1)

slowswings <- baseballdataclean2 %>%
  filter(!is.na(PLAYERNAME)) %>%
  filter(bat_speed < tenth_percentile)

pitcheraverageslow <- slowswings %>%
  group_by(PLAYERNAME) %>%
  summarize(avg_bat_speed = mean(bat_speed)) %>%
  arrange(avg_bat_speed)

pitcheraverageslow

pitchercountslow <- slowswings %>%
  group_by(PLAYERNAME) %>%
  count() %>%
  arrange(desc(n))

pitchercountslow

pitcherslowswing <- pitcheraverageslow %>% 
  left_join(pitchercountslow, by = c("PLAYERNAME" = "PLAYERNAME"))

pitcherslowswing

pitcherslowswing2 <- pitcherslowswing %>%
  filter(n >= 8)

top25slow <- pitcherslowswing2 %>%
  arrange(avg_bat_speed) %>%
  head(25)

top25slow
```
```{r}
# Calculating average spin rate by pitch type for the top 25 pitchers with the lowest average swing speed against

top25allslow <-top25slow %>%
  left_join(baseballdataclean2, by = c("PLAYERNAME" = "PLAYERNAME"))

slowspins <- top25allslow %>%
  group_by(pitch_name) %>%
  summarize(meanspinslow = mean(release_spin_rate, na.rm = TRUE))

slowspins
```
```{r}
# Showing Spin difference on average between pitchers who generate slow bat speeds vs pitchers who generate fast bat speeds

fastspins %>%
  left_join(slowspins, by = c("pitch_name" = "pitch_name")) %>%
  mutate(spindiff = meanspinslow - meanspinfast)
```



# Data Context

Our data was collected using Statcast, by CSAS (Connecticut Sports Analytics) to analyze pitcher-batter interactions in MLB. Every MLB ballpark is equipped with Statcast tracking technology, which is used to acquire the data. See this link [statcastlink](https://www.mlb.com/glossary/statcast) for more background on Statcast. It contains data on 346,250 Major League Baseball plate appearances from 4/2/2024 to 6/30/2024 (first half of the 2024 regular season), as well as 94 different variables.

Link to player ID data: [playerdatalink](https://www.smartfantasybaseball.com/tools/)

## Data Codebook

The codebook for our data can be found at this link: [codebooklink](https://baseballsavant.mlb.com/csv-docs)

# Project Topic

The effect of pitchers on batters' swing speeds and swing lengths

# Questions We Wish To Explore

1.  Do pitchers modify batters' behavior? That is do batters' swing speeds differ depending on something pitchers do?

2.  Do some pitchers elicit different swing speeds and swing lengths than others? That is, are some pitchers better at slowing down batters' swing speeds or making their swings longer?

3.  If pitchers do affect a batter's swing speed/length, what is the cause of this? Is it pitch speed, pitch movement, or something else?

# Plan

With this data, we can address all of the above questions individually:

To address these questions, we would need pitch speed, pitch movement, pitch spin, swing speed, swing length, pitcher name. Our dataset has variables that correspond to each of these measurements. Roughly, we would start by grouping by pitcher and analyzing their average pitch movements, spins, and velocities. Then, we would analyze batters' swing speeds and lengths, and filter to only look at instances when their swing speeds/lengths are unusually low or high. Then we could explore this further by looking for correlations between pitcher data and the observed unusual values for swing speed/length, while comparing to the individual hitters' average swing statistics.
